<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Flappy Bird</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    * {
      font-family: 'Press Start 2P', cursive;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    @keyframes cloudMove {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    .cloud {
      animation: cloudMove 20s linear infinite;
    }
    .bird-flap {
      animation: flap 0.15s ease-in-out;
    }
    @keyframes flap {
      0% { transform: rotate(-20deg) scale(1); }
      50% { transform: rotate(-30deg) scale(1.1); }
      100% { transform: rotate(-20deg) scale(1); }
    }
    .pipe-gradient {
      background: linear-gradient(90deg, #2d5a27 0%, #4a8b3c 20%, #5fa04e 50%, #4a8b3c 80%, #2d5a27 100%);
    }
    .pipe-cap {
      background: linear-gradient(90deg, #1f4a1a 0%, #3d7a30 20%, #4f9040 50%, #3d7a30 80%, #1f4a1a 100%);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full m-0 p-0 overflow-hidden">
  <div id="game-wrapper" class="w-full h-full relative overflow-hidden" style="background: linear-gradient(180deg, #87CEEB 0%, #98D8E8 50%, #B8E8B8 100%);"><!-- Clouds -->
   <div class="absolute top-10 left-0 w-full h-20 pointer-events-none overflow-hidden">
    <svg class="cloud absolute" style="left: 10%; animation-delay: 0s;" width="80" height="40" viewbox="0 0 80 40"><ellipse cx="40" cy="25" rx="35" ry="15" fill="rgba(255,255,255,0.8)" /> <ellipse cx="25" cy="20" rx="20" ry="12" fill="rgba(255,255,255,0.8)" /> <ellipse cx="55" cy="20" rx="20" ry="12" fill="rgba(255,255,255,0.8)" />
    </svg>
    <svg class="cloud absolute" style="left: 50%; animation-delay: -7s;" width="60" height="30" viewbox="0 0 60 30"><ellipse cx="30" cy="18" rx="25" ry="12" fill="rgba(255,255,255,0.7)" /> <ellipse cx="18" cy="15" rx="15" ry="10" fill="rgba(255,255,255,0.7)" /> <ellipse cx="42" cy="15" rx="15" ry="10" fill="rgba(255,255,255,0.7)" />
    </svg>
    <svg class="cloud absolute" style="left: 80%; animation-delay: -14s;" width="70" height="35" viewbox="0 0 70 35"><ellipse cx="35" cy="22" rx="30" ry="13" fill="rgba(255,255,255,0.75)" /> <ellipse cx="22" cy="17" rx="18" ry="11" fill="rgba(255,255,255,0.75)" /> <ellipse cx="48" cy="17" rx="18" ry="11" fill="rgba(255,255,255,0.75)" />
    </svg>
   </div><!-- Ground -->
   <div class="absolute bottom-0 left-0 w-full h-16" style="background: linear-gradient(180deg, #8B4513 0%, #654321 100%);">
    <div class="absolute top-0 left-0 w-full h-3" style="background: linear-gradient(180deg, #228B22 0%, #32CD32 100%);"></div>
   </div><!-- Game Canvas -->
   <div id="game-area" class="absolute inset-0 bottom-16"><!-- Bird -->
    <div id="bird" class="absolute w-16 h-14 md:w-12 md:h-10 transition-transform duration-75" style="left: 80px; top: 200px;">
     <svg viewbox="0 0 48 40" class="w-full h-full"><!-- Body --> <ellipse cx="24" cy="22" rx="18" ry="14" fill="#FFD700" /> <ellipse cx="24" cy="22" rx="16" ry="12" fill="#FFA500" /> <!-- Wing --> <ellipse cx="18" cy="24" rx="8" ry="6" fill="#FF8C00" /> <!-- Eye white --> <circle cx="32" cy="16" r="7" fill="white" /> <!-- Eye pupil --> <circle cx="34" cy="16" r="4" fill="#333" /> <circle cx="35" cy="15" r="1.5" fill="white" /> <!-- Beak --> <polygon points="40,22 52,24 40,26" fill="#FF6347" /> <!-- Eyebrow --> <line x1="28" y1="10" x2="38" y2="12" stroke="#333" stroke-width="2" stroke-linecap="round" />
     </svg>
    </div><!-- Pipes Container -->
    <div id="pipes-container" class="absolute inset-0"></div>
   </div><!-- Score Display -->
   <div class="absolute top-4 left-1/2 transform -translate-x-1/2 text-center">
    <div id="score-display" class="text-6xl md:text-4xl text-white drop-shadow-lg" style="text-shadow: 3px 3px 0 #333, -3px -3px 0 #333, 3px -3px 0 #333, -3px 3px 0 #333;">
     0
    </div>
    <div class="text-sm md:text-xs text-white mt-1" style="text-shadow: 1px 1px 0 #333;">
     SCORE
    </div>
   </div><!-- Progress Bar -->
   <div class="absolute top-20 left-1/2 transform -translate-x-1/2 w-48">
    <div class="bg-gray-800 rounded-full h-4 overflow-hidden border-2 border-white">
     <div id="progress-bar" class="h-full transition-all duration-300" style="width: 0%; background: linear-gradient(90deg, #FF6B6B 0%, #FFE66D 50%, #4ECB71 100%);"></div>
    </div>
    <div class="flex justify-between text-xs text-white mt-1" style="text-shadow: 1px 1px 0 #333;"><span>0</span> <span id="victory-marker" class="text-yellow-300">10 üèÜ</span> <span>‚àû</span>
    </div>
   </div><!-- Start Screen -->
   <div id="start-screen" class="absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-50 z-10">
    <div class="text-center p-8 rounded-2xl" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
     <h1 id="game-title" class="text-3xl md:text-2xl text-white mb-4" style="text-shadow: 3px 3px 0 #333;">FLAPPY BIRD</h1>
     <div class="mb-6">
      <svg class="mx-auto" viewbox="0 0 48 40" width="96" height="80" style="animation: float 1s ease-in-out infinite;"><ellipse cx="24" cy="22" rx="18" ry="14" fill="#FFD700" /> <ellipse cx="24" cy="22" rx="16" ry="12" fill="#FFA500" /> <ellipse cx="18" cy="24" rx="8" ry="6" fill="#FF8C00" /> <circle cx="32" cy="16" r="7" fill="white" /> <circle cx="34" cy="16" r="4" fill="#333" /> <circle cx="35" cy="15" r="1.5" fill="white" /> <polygon points="40,22 52,24 40,26" fill="#FF6347" /> <line x1="28" y1="10" x2="38" y2="12" stroke="#333" stroke-width="2" stroke-linecap="round" />
      </svg>
     </div>
     <p class="text-white text-base md:text-xs mb-4">üì± TAP SCREEN TO FLY! üì±</p>
     <p class="text-yellow-300 text-sm md:text-xs mb-2">üèÜ Victory at 10 points!</p>
     <p class="text-green-300 text-sm md:text-xs mb-6">‚àû Unlimited Score!</p><button id="start-btn" class="px-10 py-5 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white rounded-2xl text-lg font-bold transition-all transform active:scale-95" style="text-shadow: 1px 1px 0 #333; min-width: 200px;"> START GAME </button>
    </div>
   </div><!-- Game Over Screen -->
   <div id="gameover-screen" class="absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-60 z-10 hidden">
    <div class="text-center p-8 rounded-2xl max-w-md mx-4" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
     <h2 id="result-title" class="text-2xl md:text-xl text-white mb-4" style="text-shadow: 2px 2px 0 #333;">GAME OVER</h2>
     <div id="result-icon" class="text-7xl mb-4">
      üíî
     </div>
     <p class="text-white text-base mb-2">Your Score</p>
     <p id="final-score" class="text-5xl text-yellow-300 mb-4" style="text-shadow: 2px 2px 0 #333;">0</p>
     <p id="result-message" class="text-white text-sm mb-6">Try again!</p><button id="restart-btn" class="px-10 py-5 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white rounded-2xl text-lg font-bold transition-all transform active:scale-95" style="text-shadow: 1px 1px 0 #333; min-width: 200px;"> PLAY AGAIN </button>
    </div>
   </div><!-- Victory Screen -->
   <div id="victory-screen" class="absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-60 z-10 hidden">
    <div class="text-center p-8 rounded-2xl max-w-md mx-4" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
     <h2 id="victory-title" class="text-2xl md:text-xl text-white mb-4" style="text-shadow: 2px 2px 0 #333;">üéâ VICTORY! üéâ</h2>
     <div class="text-7xl mb-4">
      üèÜ
     </div>
     <p class="text-white text-base mb-2">Final Score</p>
     <p id="victory-score" class="text-5xl text-yellow-300 mb-4" style="text-shadow: 2px 2px 0 #333;">10</p>
     <p id="victory-text" class="text-white text-sm mb-6">You're a Flappy Bird Master!</p><button id="victory-restart-btn" class="px-10 py-5 bg-purple-500 hover:bg-purple-600 active:bg-purple-700 text-white rounded-2xl text-lg font-bold transition-all transform active:scale-95" style="text-shadow: 1px 1px 0 #333; min-width: 200px;"> PLAY AGAIN </button>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      game_title: "FLAPPY BIRD",
      victory_message: "You're a Flappy Bird Master!",
      game_over_message: "Try again!",
      background_color: "#87CEEB",
      text_color: "#FFFFFF",
      accent_color: "#FFD700",
      button_color: "#4CAF50",
      secondary_color: "#667eea"
    };

    let config = { ...defaultConfig };

    // Create Audio Context for tap sound
    let audioContext;
    function initAudioContext() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    // Play tap/click sound using Web Audio API
    function playTapSound() {
      if (!audioContext) {
        initAudioContext();
      }
      
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.value = 800;
      oscillator.type = 'sine';
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.1);
    }

    // Game variables
    let bird, pipesContainer, scoreDisplay, progressBar;
    let birdY = 200;
    let birdVelocity = 0;
    let gravity = 0.5;
    let jumpStrength = -8;
    let score = 0;
    let victoryScore = 10;
    let gameRunning = false;
    let pipes = [];
    let pipeSpeed = 3;
    let pipeGap = 180;
    let pipeWidth = 60;
    let pipeSpawnInterval;
    let gameLoop;
    let groundHeight = 64;
    let victoryShown = false;

    // Bird hitbox constants (reduced for more forgiving gameplay)
    const BIRD_WIDTH = 64;
    const BIRD_HEIGHT = 56;
    const BIRD_HITBOX_MARGIN = 12; // Reduce effective hitbox by this margin

    function initGame() {
      bird = document.getElementById('bird');
      pipesContainer = document.getElementById('pipes-container');
      scoreDisplay = document.getElementById('score-display');
      progressBar = document.getElementById('progress-bar');

      document.getElementById('start-btn').addEventListener('click', startGame);
      document.getElementById('restart-btn').addEventListener('click', restartGame);
      document.getElementById('victory-restart-btn').addEventListener('click', restartGame);

      // Keyboard controls
      document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
          e.preventDefault();
          if (!gameRunning) {
            const startScreen = document.getElementById('start-screen');
            const gameoverScreen = document.getElementById('gameover-screen');
            const victoryScreen = document.getElementById('victory-screen');
            if (startScreen.classList.contains('hidden') === false) {
              startGame();
            } else if (!gameoverScreen.classList.contains('hidden') || !victoryScreen.classList.contains('hidden')) {
              restartGame();
            }
          } else {
            jump();
          }
        }
      });

      // Touch and click controls for entire game wrapper
      const gameWrapper = document.getElementById('game-wrapper');
      
      // Handle touch events on the entire screen
      gameWrapper.addEventListener('touchstart', (e) => {
        if (gameRunning) {
          e.preventDefault();
          jump();
        }
      }, { passive: false });

      // Also handle clicks for desktop testing
      gameWrapper.addEventListener('click', (e) => {
        if (gameRunning) {
          e.preventDefault();
          jump();
        }
      });

      // Prevent scrolling on the entire page
      document.body.addEventListener('touchmove', (e) => {
        e.preventDefault();
      }, { passive: false });

      // Prevent double-tap zoom
      let lastTap = 0;
      gameWrapper.addEventListener('touchend', (e) => {
        const currentTime = new Date().getTime();
        const tapLength = currentTime - lastTap;
        if (tapLength < 300 && tapLength > 0) {
          e.preventDefault();
        }
        lastTap = currentTime;
      }, false);
    }

    function startGame() {
      initAudioContext();
      
      document.getElementById('start-screen').classList.add('hidden');
      document.getElementById('gameover-screen').classList.add('hidden');
      document.getElementById('victory-screen').classList.add('hidden');
      
      birdY = 200;
      birdVelocity = 0;
      score = 0;
      pipes = [];
      victoryShown = false;
      pipesContainer.innerHTML = '';
      updateScore();
      
      gameRunning = true;
      
      gameLoop = requestAnimationFrame(update);
      pipeSpawnInterval = setInterval(spawnPipe, 2000);
    }

    function restartGame() {
      startGame();
    }

    function jump() {
      birdVelocity = jumpStrength;
      bird.querySelector('svg').classList.remove('bird-flap');
      void bird.querySelector('svg').offsetWidth;
      bird.querySelector('svg').classList.add('bird-flap');
      playTapSound();
    }

    function spawnPipe() {
      if (!gameRunning) return;
      
      const gameArea = document.getElementById('game-area');
      const gameHeight = gameArea.offsetHeight;
      const minTop = 60;
      const maxTop = gameHeight - pipeGap - 100;
      const topHeight = Math.random() * (maxTop - minTop) + minTop;
      
      const pipeTop = document.createElement('div');
      pipeTop.className = 'pipe absolute';
      pipeTop.style.cssText = `
        right: -${pipeWidth}px;
        top: 0;
        width: ${pipeWidth}px;
        height: ${topHeight}px;
      `;
      pipeTop.innerHTML = `
        <div class="pipe-gradient h-full w-full relative">
          <div class="pipe-cap absolute bottom-0 left-[-4px] right-[-4px] h-6 rounded-sm"></div>
        </div>
      `;
      
      const pipeBottom = document.createElement('div');
      pipeBottom.className = 'pipe absolute';
      const bottomTop = topHeight + pipeGap;
      pipeBottom.style.cssText = `
        right: -${pipeWidth}px;
        top: ${bottomTop}px;
        width: ${pipeWidth}px;
        height: ${gameHeight - bottomTop}px;
      `;
      pipeBottom.innerHTML = `
        <div class="pipe-gradient h-full w-full relative">
          <div class="pipe-cap absolute top-0 left-[-4px] right-[-4px] h-6 rounded-sm"></div>
        </div>
      `;
      
      pipesContainer.appendChild(pipeTop);
      pipesContainer.appendChild(pipeBottom);
      
      pipes.push({
        top: pipeTop,
        bottom: pipeBottom,
        x: gameArea.offsetWidth,
        topHeight: topHeight,
        bottomTop: bottomTop,
        scored: false,
        passed: false
      });
    }

    function checkCollision(birdLeft, birdRight, birdTop, birdBottom, pipeLeft, pipeRight, topHeight, bottomTop) {
      // Check if bird horizontally overlaps with pipe
      if (birdRight <= pipeLeft || birdLeft >= pipeRight) {
        return false; // No horizontal overlap - safe
      }
      
      // Bird is within pipe horizontally - check vertical position
      // Is bird in the safe gap?
      const inSafeGap = (birdBottom <= bottomTop) && (birdTop >= topHeight);
      
      if (inSafeGap) {
        return false; // Bird is in the gap - safe
      }
      
      return true; // Collision detected
    }

    function update() {
      if (!gameRunning) return;
      
      // Bird physics
      birdVelocity += gravity;
      birdY += birdVelocity;
      
      // Rotation based on velocity
      const rotation = Math.min(Math.max(birdVelocity * 3, -30), 90);
      bird.style.top = birdY + 'px';
      bird.style.transform = `rotate(${rotation}deg)`;
      
      const gameArea = document.getElementById('game-area');
      const gameHeight = gameArea.offsetHeight;
      const gameWidth = gameArea.offsetWidth;
      
      // Ground collision
      if (birdY + BIRD_HEIGHT >= gameHeight) {
        gameOver();
        return;
      }
      
      // Ceiling collision
      if (birdY <= 0) {
        gameOver();
        return;
      }
      
      // Bird collision boundaries with margin for forgiving gameplay
      const birdLeft = 80 + BIRD_HITBOX_MARGIN;
      const birdRight = 80 + BIRD_WIDTH - BIRD_HITBOX_MARGIN;
      const birdTop = birdY + BIRD_HITBOX_MARGIN;
      const birdBottom = birdY + BIRD_HEIGHT - BIRD_HITBOX_MARGIN;
      
      // Update pipes and check collisions
      for (let i = pipes.length - 1; i >= 0; i--) {
        const pipe = pipes[i];
        pipe.x -= pipeSpeed;
        
        pipe.top.style.right = (gameWidth - pipe.x) + 'px';
        pipe.bottom.style.right = (gameWidth - pipe.x) + 'px';
        
        const pipeLeft = pipe.x;
        const pipeRight = pipe.x + pipeWidth;
        
        // Check collision with this pipe
        if (checkCollision(birdLeft, birdRight, birdTop, birdBottom, pipeLeft, pipeRight, pipe.topHeight, pipe.bottomTop)) {
          gameOver();
          return;
        }
        
        // Score when bird center passes pipe center
        const birdCenterX = 80 + (BIRD_WIDTH / 2);
        const pipeCenterX = pipe.x + (pipeWidth / 2);
        
        if (!pipe.scored && birdCenterX > pipeCenterX && !pipe.passed) {
          pipe.scored = true;
          pipe.passed = true;
          score++;
          updateScore();
          
          // Show victory screen only once at exactly 50 points
          if (score === victoryScore && !victoryShown) {
            victoryShown = true;
            victory();
            return;
          }
        }
        
        // Remove off-screen pipes
        if (pipe.x + pipeWidth < -50) {
          pipe.top.remove();
          pipe.bottom.remove();
          pipes.splice(i, 1);
        }
      }
      
      gameLoop = requestAnimationFrame(update);
    }

    function updateScore() {
      scoreDisplay.textContent = score;
      const progress = Math.min((score / victoryScore) * 100, 100);
      progressBar.style.width = progress + '%';
    }

    function gameOver() {
      gameRunning = false;
      clearInterval(pipeSpawnInterval);
      cancelAnimationFrame(gameLoop);
      
      document.getElementById('final-score').textContent = score;
      document.getElementById('result-message').textContent = config.game_over_message || defaultConfig.game_over_message;
      document.getElementById('gameover-screen').classList.remove('hidden');
    }

    function victory() {
      gameRunning = false;
      clearInterval(pipeSpawnInterval);
      cancelAnimationFrame(gameLoop);
      
      document.getElementById('victory-score').textContent = score;
      document.getElementById('victory-text').textContent = config.victory_message || defaultConfig.victory_message;
      document.getElementById('victory-screen').classList.remove('hidden');
    }

    // Element SDK Integration
    async function onConfigChange(newConfig) {
      config = { ...defaultConfig, ...newConfig };
      
      document.getElementById('game-title').textContent = config.game_title || defaultConfig.game_title;
      document.getElementById('victory-text').textContent = config.victory_message || defaultConfig.victory_message;
      document.getElementById('result-message').textContent = config.game_over_message || defaultConfig.game_over_message;
    }

    function mapToCapabilities(cfg) {
      return {
        recolorables: [
          {
            get: () => cfg.background_color || defaultConfig.background_color,
            set: (value) => {
              cfg.background_color = value;
              window.elementSdk.setConfig({ background_color: value });
            }
          },
          {
            get: () => cfg.secondary_color || defaultConfig.secondary_color,
            set: (value) => {
              cfg.secondary_color = value;
              window.elementSdk.setConfig({ secondary_color: value });
            }
          },
          {
            get: () => cfg.text_color || defaultConfig.text_color,
            set: (value) => {
              cfg.text_color = value;
              window.elementSdk.setConfig({ text_color: value });
            }
          },
          {
            get: () => cfg.button_color || defaultConfig.button_color,
            set: (value) => {
              cfg.button_color = value;
              window.elementSdk.setConfig({ button_color: value });
            }
          },
          {
            get: () => cfg.accent_color || defaultConfig.accent_color,
            set: (value) => {
              cfg.accent_color = value;
              window.elementSdk.setConfig({ accent_color: value });
            }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(cfg) {
      return new Map([
        ["game_title", cfg.game_title || defaultConfig.game_title],
        ["victory_message", cfg.victory_message || defaultConfig.victory_message],
        ["game_over_message", cfg.game_over_message || defaultConfig.game_over_message]
      ]);
    }

    // Initialize
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    initGame();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bfd26ea63100b19',t:'MTc2ODcyOTQ0OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>